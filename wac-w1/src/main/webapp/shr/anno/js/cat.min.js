function CustomContextMenu(b){this.Version="2.1";this.xLeft=0;this.yTop=0;var f=b.Base?b.Base:document.documentElement;var n=b.Width?b.Width:100;var l=b.FontColor?b.FontColor:"black";var i=b.HoverFontColor?b.HoverFontColor:"white";var g=b.HoverBackgroundColor?b.HoverBackgroundColor:"#008080";var m=b.ClickEventListener?b.ClickEventListener:function(r,q,p){return false};var j=document.createElement("div");var a=document.createElement("table");var d=0;var k=new Array();j.id=b.id?b.id:"ContextMenu";j.style.position="absolute";j.style.backgroundColor="white";j.style.boxShadow="0px 0px 4px #005050, 0px 4px 8px #005050";j.style.textAlign="left";j.style.visibility="hidden";j.style.width=(n+11)+"px";a.id="ContextMenuTable";a.style.width=(n+10)+"px";a.border=0;a.cellPadding=0;a.cellSpacing=0;j.appendChild(a);this.AddItem=function(v,t,u,p,w){var q=new Image();var s=a.insertRow(d++);s.style.backgroundColor="white";s.style.color=u?"gray":l;s.style.cursor="default";var r=s.insertCell(0);r.style.width="25px";r.style.height="25px";r.style.textAlign="center";r.style.verticalAlign="middle";r.style.backgroundColor="rgba(00,80,80,0.2)";var x=s.insertCell(1);x.style.width=(n-25)+"px";x.style.height="25px";x.style.padding="2px";x.style.fontStyle=u?"italic":"normal";x.innerHTML=t?t:"&nbsp;";if(v){q.id="Img";q.src=v;q.style.width="16px";q.style.height="16px";q.disabled=u;r.appendChild(q)}else{r.innerHTML="&nbsp;"}if(!u){if(typeof w==="function"){h(s,"click",function(){w(s,{CommandName:p,Text:t,IsDisabled:u,ImageUrl:q?q.src:""},f)})}else{h(s,"click",function(){m(s,{CommandName:p,Text:t,IsDisabled:u,ImageUrl:q?q.src:""},f)})}h(s,"mouseover",function(){e(s,r,x)});h(s,"mouseout",function(){c(s,r,x)})}else{h(s,"click",function(){return false});h(x,"selectstart",function(){return false})}};this.AddSeparatorItem=function(){var r=a.insertRow(d++);r.style.cursor="default";var p=r.insertCell(0);p.style.width="25px";p.style.height="1px";p.style.backgroundColor="rgba(00,80,80,0.2)";var q=r.insertCell(1);q.style.width=(n-25)+"px";q.style.height="1px";q.style.backgroundColor="gray"};this.AddInputItem=function(){var s=a.insertRow(d++);s.style.cursor="default";var q=s.insertCell(0);q.style.width="25px";q.style.height="1px";q.style.backgroundColor="rgba(00,80,80,0.2)";var r=s.insertCell(1);r.style.width=(n-25)+"px";r.style.height="1px";r.style.backgroundColor="gray";var p=document.createElement("input");p.setAttribute("type","text");p.setAttribute("style","width:100%;");r.appendChild(p)};this.Display=function(p){p=p?p:window.event;this.xLeft=p.clientX;if(this.xLeft+j.offsetWidth>window.innerWidth){this.xLeft=window.innerWidth-j.offsetWidth}this.yTop=p.clientY;if(this.yTop+j.offsetHeight>window.innerHeight){this.yTop=window.innerHeight-j.offsetHeight}j.style.visibility="hidden";j.style.left=this.xLeft+"px";j.style.top=this.yTop+"px";j.style.visibility="visible";return false};this.Hide=function(){j.style.visibility="hidden"};this.Dispose=function(){while(k.length>0){o(k.pop())}document.body.removeChild(j)};this.GetTotalItems=function(){return a.getElementsByTagName("tr").length};var e=function(r,p,q){r.style.color=i;r.style.backgroundColor=g};var c=function(r,p,q){r.style.color=l;r.style.backgroundColor="white"};var h=function(r,p,s){if(r.addEventListener){r.addEventListener(p,s,false)}else{if(r.attachEvent){r.attachEvent("on"+p,s)}else{p="on"+p;r.Event=s}}var q={Target:r,Event:p,Listener:s};k.push(q)};var o=function(p){if(p.Target.removeEventListener){p.Target.removeEventListener(p.Event,p.Listener,false)}else{if(p.Target.detachEvent){p.Target.detachEvent("on"+p.Event,p.Listener)}else{p.Event="on"+p.Event;p.Target.EVENT.Event=null}}};document.body.appendChild(j);h(f,"click",this.Hide);h(j,"contextmenu",function(){return false})}var Base=function(){};Base.extend=function(b,e){var f=Base.prototype.extend;Base._prototyping=true;var d=new this;f.call(d,b);d.base=function(){};delete Base._prototyping;var c=d.constructor;var a=d.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==a){this._constructing=true;c.apply(this,arguments);delete this._constructing}else{if(arguments[0]!=null){return(arguments[0].extend||f).call(arguments[0],d)}}}};a.ancestor=this;a.extend=this.extend;a.forEach=this.forEach;a.implement=this.implement;a.prototype=d;a.toString=this.toString;a.valueOf=function(g){return(g=="object")?a:c.valueOf()};f.call(a,e);if(typeof a.init=="function"){a.init()}return a};Base.prototype={extend:function(b,h){if(arguments.length>1){var e=this[b];if(e&&(typeof h==="function")&&(!e.valueOf||e.valueOf()!=h.valueOf())&&/\bbase\b/.test(h)){var a=h.valueOf();h=function(){var k=this.base||Base.prototype.base;this.base=e;var i=a.apply(this,arguments);this.base=k;return i};h.valueOf=function(i){return(i=="object")?h:a};h.toString=Base.toString}this[b]=h}else{if(b){var g=Base.prototype.extend;if(!Base._prototyping&&typeof this!=="function"){g=this.extend||g}var d={toSource:null};var f=["constructor","toString","valueOf"];var c=Base._prototyping?0:1;while(j=f[c++]){if(b[j]!=d[j]){g.call(this,j,b[j])}}for(var j in b){if(!d[j]){g.call(this,j,b[j])}}}}return this}};Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(a,d,c){for(var b in a){if(this.prototype[b]===undefined){d.call(c,a[b],b,a)}}},implement:function(){for(var a=0;a<arguments.length;a++){if(typeof arguments[a]==="function"){arguments[a](this.prototype)}else{this.prototype.extend(arguments[a])}}return this},toString:function(){return String(this.valueOf())}});(function(b){var a=b.WAC||(b.WAC={});a.anno=a.anno||{};if(a.anno.wacCommand){console.warn("WAC.anno.wacCommand is already defined");return}a.anno.wacCommand=Base.extend({constructor:function(d,c){this.cmdType=d;this.objID=c},apply:function(c){var d=(this.objID===c._Object.getID())?c._Object:c._Object.findObjectByID(this.objID);this.applyCmd(d)},applyCmd:function(c){}},{})})(this);(function(b){var a=b.WAC||(b.WAC={});a.anno=a.anno||{};if(a.anno.wacGObject){console.warn("WAC.anno.wacGObject is already defined");return}a.anno.wacGObject=Base.extend({constructor:function(d,c){this._ID=d;this._annotationObject=true;this._type="WAC.anno.wacGObject";this._lineColor="#00008B";this._fillColor="#C0C0C0";this._highlightColor="#ff0000";this._visible=true;this._highlighted=false;this._lineWidth=2;this._X=0;this._Y=0;this._W=0;this._H=0;this._parentObject=null;this.HOT_DISTANCE=5;this._ctx=c;if(c){this.canvas=a.anno.wacUtil.getCanvas(c)}},setEntity:function(c){this.entity=c},getEntity:function(){return this.entity},getID:function(){return this._ID},getMouseX:function(c){return a.anno.wacUtil.getMouseX(c)},getMouseY:function(c){return a.anno.wacUtil.getMouseY(c)},mouseEnter:function(d,c,e){this.canvas.style.cursor="move";return false},mouseExit:function(d,c,e){this.canvas.style.cursor="auto";return false},mouseDown:function(d,c,e){return false},mouseDrag:function(d,c,e){return false},mouseUp:function(d,c,e){return false},mouseMove:function(d,c,e){return false},mouseDoubleClick:function(d,c,e){return false},isVisible:function(d,c,e){return this._visible},highlight:function(){this._highlighted=true},unhighlight:function(){this._highlighted=false},setVisible:function(c){this._visible=c},draw:function(c){},computeDistance:function(d,f,c,e){return Math.sqrt((d-c)*(d-c)+(f-e)*(f-e))},withinHotDistance:function(d,f,c,e){return(this.computeDistance(d,f,c,e)<=this.HOT_DISTANCE)},hide:function(){this._visible=false},show:function(){this._visible=true},move:function(d,e,c){},getObjectData:function(){return{id:this._ID,type:this._type,lineWidth:this._lineWidth,lineColor:this._lineColor,fillColor:this._fillColor}},restoreFromData:function(c){this._ID=c.id;this._type=c.type;this._lineWidth=parseInt(""+c.lineWidth);this._lineColor=c.lineColor;this._fillColor=c.fillColor},sendCommand:function(c){if(this.canvas.self){this.canvas.self.sendCommand(c)}else{if(this._ctx.self){this._ctx.self.sendCommand(c)}}}},{});a.anno.wacCmd_SetColor=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetColor",arguments[0].objID);this.propName=arguments[0].propName;this.color=arguments[0].color}else{if(arguments.length==3){this.base("wacCmd_SetColor",arguments[0]);this.propName=arguments[1];this.color=arguments[2]}else{throw"Error:  wrong number of arguments for wacCmd_SetColor(should be 3)"}}},applyCmd:function(c){a.anno.wacUtil.setPropertyColor(c,this.propName,this.color)}},{});a.anno.wacCmd_SetLineWidth=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetLineWidth",arguments[0].objID);this.lineWidth=parseInt(arguments[0].lineWidth)}else{if(arguments.length==2){this.base("wacCmd_SetLineWidth",arguments[0]);this.lineWidth=parseInt(arguments[1])}else{throw"Error:  wrong number of arguments for wacCmd_SetLineWidth(should be 2)"}}},applyCmd:function(c){a.anno.wacUtil.setLineWidth(c,this.lineWidth)}},{});a.anno.wacCmd_SetAltitude=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetAltitude",arguments[0].objID);this.altitude=parseInt(arguments[0].altitude)}else{if(arguments.length==2){this.base("wacCmd_SetAltitude",arguments[0]);this.altitude=parseInt(arguments[1])}else{throw"Error:  wrong number of arguments for wacCmd_SetLineWidth(should be 2)"}}},applyCmd:function(c){a.anno.wacUtil.setAltitude(c,this.altitude)}},{});a.anno.wacCmd_SetOpacity=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetOpacity",arguments[0].objID);this.opacity=parseFloat(arguments[0].opacity)}else{if(arguments.length==2){this.base("wacCmd_SetOpacity",arguments[0]);this.opacity=parseFloat(arguments[1])}else{throw"Error:  wrong number of arguments for wacCmd_SetLineWidth(should be 2)"}}},applyCmd:function(c){c.setOpacity(this.opacity)}},{})})(this);(function(b){var a=b.WAC||(b.WAC={});a.anno=a.anno||{};if(a.anno.wacCompositeObject){console.warn("WAC.anno.wacCompositeObject is already defined");return}a.anno.wacCompositeObject=a.anno.wacGObject.extend({constructor:function(d,c){this.base(d,c);this._type="WAC.anno.wacCompositeObject";this._GUIObject=null;this._Shapes=[]},findObjectByID:function(d){for(var c=0;c<this._Shapes.length;c++){if(this._Shapes[c].getID()===d){return this._Shapes[c]}}return null},add:function(d,c){if(c===undefined){this._Shapes.splice(this._Shapes.length,0,d)}else{this._Shapes.splice(c,0,d)}d._parentObject=this},remove:function(d){for(var c=0;c<this._Shapes.length;c++){if(this._Shapes[c]===d){this.removeAt(c);d._parentObject=null}}},removeAt:function(c){if(this._GUIObject==this._Shapes[c]){this._GUIObject=null}this._Shapes[c]._parentObject=null;this._Shapes.splice(c,1)},indexOf:function(d){for(var c=0;c<this._Shapes.length;c++){if(this._Shapes[c]===d){return c}}},mouseEnter:function(d,c,f){var e=this.base(d,c,f);if(e==false&&this._GUIObject!=null){e=this._GUIObject.mouseEnter(d,c,f)}return(e)},mouseDown:function(d,c,f){var e=this.base(d,c,f);if(e==false&&this._GUIObject!=null){e=this._GUIObject.mouseDown(d,c,f)}return(e)},mouseDrag:function(d,c,f){var e=this.base(d,c,f);if(e==false&&this._GUIObject!=null){e=this._GUIObject.mouseDrag(d,c,f)}return(e)},mouseUp:function(d,c,f){var e=this.base(d,c,f);if(e==false&&this._GUIObject!=null){e=this._GUIObject.mouseUp(d,c,f)}return(e)},mouseExit:function(d,c,f){var e=this.base(d,c,f);if(e==false&&this._GUIObject!=null){e=this._GUIObject.mouseExit(d,c,f);this._GUIObject=null}return(e)},mouseMove:function(d,c,f){var e=this.getGUIObject(c,f);if(e){if(this._GUIObject==null){this._GUIObject=e;this._GUIObject.mouseEnter(d,c,f);this._GUIObject.mouseMove(d,c,f)}else{if(this._GUIObject&&(e!==this._GUIObject)){this._GUIObject.mouseExit(d,c,f);this._GUIObject=e;this._GUIObject.mouseEnter(d,c,f);this._GUIObject.mouseMove(d,c,f)}else{if(this._GUIObject!=null){this._GUIObject.mouseMove(d,c,f)}}}}else{if(this._GUIObject!=null){this._GUIObject.mouseExit(d,c,f);this._GUIObject=null}}},mouseDoubleClick:function(d,c,f){var e=this.base(d,c,f);if(e==false&&this._GUIObject!=null){e=this._GUIObject.mouseDoubleClick(d,c,f)}return(e)},keyDown:function(c,e){var d=this.base(c,e);if(d==false&&this._GUIObject!=null){d=this._GUIObject.keyDown(c,e)}return(d)},hide:function(){this.base();for(var c=0;c<this._Shapes.length;c++){this._Shapes[c].hide()}},show:function(){this.base();for(var c=0;c<this._Shapes.length;c++){this._Shapes[c].show()}},draw:function(){this.base();for(var c=0;c<this._Shapes.length;c++){this._Shapes[c].draw()}},getGUIObject:function(c,d){return a.anno.wacUtil.getGUIObject(this,c,d)}},{});a.anno.wacCmd_AddObject=a.anno.wacCommand.extend({constructor:function(d,c){this.base("wacCmd_AddObject",d);this.obj=c},applyCmd:function(c){c.add(this.obj)}},{});a.anno.wacCmd_RemoveObject=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_RemoveObject",arguments[0].objID);this.obj_id=arguments[0].obj_id}else{if(arguments.length==2){this.base("wacCmd_RemoveObject",arguments[0]);this.obj_id=arguments[1]}else{throw"Error:  wrong number of arguments for wacCmd_RemoveObject(should be 2)"}}},applyCmd:function(c){var d=c.findObjectByID(this.obj_id);d.remove()}},{})})(this);(function(b){var a=b.WAC||(b.WAC={});a.anno=a.anno||{};if(a.anno.wacContainerObject){console.warn("WAC.anno.wacContainerObject is already defined");return}a.anno.wacContainerObject=a.anno.wacCompositeObject.extend({constructor:function(d,c){this.base(d,c);this._type="WAC.anno.wacContainerObject";this._SelectedObjects=[];this._CurrentSlectedObject=null;this._GUIObject=null;this._newObject=null;this._x1=-1;this._y1=-1},setNewObject:function(c){this._newObject=c;this.add(this._newObject)},remove:function(d){this.base(d);for(var c=0;c<this._SelectedObjects.length;c++){if(this._SelectedObjects[c]===d){this._SelectedObjects.splice(c,1)}}},mouseDown:function(d,c,f){if(this._newObject!==null){this._newObject.init(d,c,f);this.draw();this.mouseMove(d,c,f);this._GUIObject=this._newObject;this._GUIObject.mouseMove(d,c,f);this._newObject=null}this._x1=c;this._y1=f;if(this._GUIObject!==null){if(d.ctrlKey===true){if(this._SelectedObjects.indexOf(this._GUIObject)!==-1){this._CurrentSelectedObject=this._GUIObject}else{this._SelectedObjects.push(this._GUIObject);this._CurrentSelectedObject=null}}else{if(this._SelectedObjects.indexOf(this._GUIObject)!==-1){this._CurrentSelectedObject=this._GUIObject}else{this._CurrentSelectedObject=null;this._SelectedObjects=[];if(this._GUIObject!=null){this._SelectedObjects.push(this._GUIObject)}}}}else{if(d.ctrlKey===false){this._SelectedObjects=[];this._CurrentSelectedObject=null}}if(this._GUIObject!==null){return this._GUIObject.mouseDown(d,c,f)}return false},mouseDrag:function(e,c,j){var i=this.getMouseX(e);var h=this.getMouseY(e);if(this._SelectedObjects.length===1){var g=this._SelectedObjects[0].mouseDrag(e,i,h);if(g===false){var f=i-this._x1;var d=h-this._y1;this.moveSelectedObjects(e,f,d);if(this._SelectedObjects[0]._type==="WAC.anno.wacRect"){}else{if(this._SelectedObjects[0]._type==="WAC.anno.wacLine"){}else{if(this._SelectedObjects[0]._type==="WAC.anno.wacFreeHand"){this.sendCommand(new a.anno.wacCmd_MoveFreeHand(this._SelectedObjects[0].getID(),f,d))}else{if(this._SelectedObjects[0]._type==="WAC.anno.wacNote"){this.sendCommand(new a.anno.wacCmd_MoveRect(this._SelectedObjects[0].getID(),f,d))}}}}this._x1=i;this._y1=h}}else{this.moveSelectedObjects(e,i-this._x1,h-this._y1);this._x1=i;this._y1=h}},mouseUp:function(d,c,f){if(this._GUIObject!==null){if(d.ctrlKey===true){if((this._GUIObject===this._CurrentSelectedObject)&&(this._CurrentSelectedObject!==null)&&(this._SelectedObjects!==null)&&(this._SelectedObjects.indexOf(this._CurrentSelectedObject)!==-1)){if((Math.abs(c-this._x1)<3)&&(Math.abs(f-this._y1)<3)){this._SelectedObjects.splice(this._SelectedObjects.indexOf(this._CurrentSelectedObject),1)}}}else{if((Math.abs(c-this._x1)<3)&&(Math.abs(f-this._y1)<3)){this._SelectedObjects=[];if(this._GUIObject!=null){this._SelectedObjects.push(this._GUIObject)}}}}this._CurrentSelectedObject=null;if(this._GUIObject!==null){return this._GUIObject.mouseUp(d,c,f)}return false},mouseMove:function(d,c,f){var e=(this._newObject===null)?this.base(d,c,f):false;return e},moveSelectedObjects:function(g,d,c){for(var f=0;f<this._SelectedObjects.length;f++){this._SelectedObjects[f].move(g,d,c)}}},{})})(this);(function(global){var WAC=global.WAC||(global.WAC={});WAC.anno=WAC.anno||{};var wsapi;if(WAC.anno.wacCanvas){console.warn("WAC.anno.wacCanvas is already defined");return}WAC.anno.wacCanvas=function(canvas){this.type="WAC.anno.wacCanvas";this.canvas=canvas;var cvs=canvas;this.canvas.self=this;if(this.canvas.getContext){this.ctx=this.canvas.getContext("2d");this.canvas.onmousedown=function(evt){this.self.onMouseDown(evt)};this.canvas.onmousemove=function(evt){this.self.onMouseMove(evt)};this.canvas.onmouseup=function(evt){this.self.onMouseUp(evt)};this.canvas.onclick=function(evt){this.self.onMouseUp(evt)};this.canvas.ondblclick=function(evt){this.self.onLeftMouseDoubleClick(evt)};this.canvas.oncontextmenu=function(evt){this.self.onContextMenu(evt);return false}}else{this.ctx=this.canvas}this._Object=new WAC.anno.wacContainerObject(0,this.ctx);this._isMousePressed=false;this.__objectID=1;this._scaleFactorX=1;this._scaleFactorY=1;this._rightClickX=null;this._rightClickY=null;this.menus={};this.menu_displayed=false;this.getUniqueObjectID=function(){this.getLargestObjectID(this._Object);return(this.__objectID++)};this.getLargestObjectID=function(obj){if((obj===undefined)||(obj===null)){return}if(obj._ID>=this.__objectID){this.__objectID=obj._ID+1}if((obj._Shapes!==undefined)&&(obj._Shapes!==null)){for(var i=0;i<obj._Shapes.length;i++){this.getLargestObjectID(obj._Shapes[i])}}};this.onContextMenu=function(evt){this._rightClickX=this._getMouseX(evt);this._rightClickY=this._getMouseY(evt);if(this._Object._GUIObject!==null){this.displayMenu(this._Object._GUIObject._type,evt)}else{this.displayMenu("WAC.anno.wacCanvas",evt)}};this.displayMenu=function(menu_name,evt){var mn=this.menus[menu_name];if(mn===undefined||mn===null){return}this.menu_displayed=true;if(this.canvas.getContext){this.menus[menu_name].Display(evt)}else{this.menus[menu_name].Display(evt)}};this._getMouseX=function(evt){return WAC.anno.wacUtil.getMouseX(evt)};this._getMouseY=function(evt){return WAC.anno.wacUtil.getMouseY(evt)};this.hideMenus=function(){this.menu_displayed=false;for(var menu in this.menus){if(this.menus.hasOwnProperty(menu)){this.menus[menu].Hide()}}};this.onMouseDown=function(evt){var m_d=this.menu_displayed;this.hideMenus();if((evt.which!==undefined&&evt.which===1)||this.canvas.scene){var x=this._getMouseX(evt);var y=this._getMouseY(evt);if(x&&y){this._isMousePressed=true;if(m_d){var obj=this._Object.getGUIObject(x,y);if((obj===undefined)||(obj===null)){if(this._Object._GUIObject!==null){this._Object._GUIObject.canvas.style.cursor="auto"}this._Object._GUIObject=null;this._Object._CurrentSelectedObject=null;this._Object._SelectedObjects=[];return}}this._Object.mouseDown(evt,x,y)}}if(this._Object._GUIObject!==null){if(this.canvas.scene){this.canvas.scene.screenSpaceCameraController.enableInputs=false}}};this.onMouseMove=function(evt){if(this.menu_displayed===true){return}var me_x=this._getMouseX(evt);var me_y=this._getMouseY(evt);if(me_x===undefined||me_y===undefined){return}var me_x1=this._getMouseX(evt);var me_y1=this._getMouseY(evt);if(this._isMousePressed){var pos={x:me_x,y:me_y};if(this._Object._GUIObject!==null){this._Object.mouseDrag(evt,me_x,me_y)}else{}if(this.ctx.clearRect){var target=evt.target||evt.srcElement;if(target){var rect=target.getBoundingClientRect();this.ctx.clearRect(rect.left,rect.top,(rect.width+window.scrollX)/this._scaleFactorX,(rect.height+window.scrollY)/this._scaleFactorY)}}this._Object.draw(this.ctx)}else{this._Object.mouseMove(evt,me_x,me_y)}};this.onMouseUp=function(evt){var me_x=this._getMouseX(evt);var me_y=this._getMouseY(evt);if(me_x===undefined||me_y===undefined){return}if((evt.which!=undefined&&evt.which==1)||this.canvas.scene){if(this._isMousePressed&&this._Object._GUIObject===null){}else{this._Object.mouseUp(evt,me_x,me_y)}this._isMousePressed=false}else{this._Object.mouseUp(evt,me_x,me_y)}this.redraw();if(this._Object._GUIObject!==null){if(this.canvas.scene){this.canvas.scene.screenSpaceCameraController.enableInputs=true}}};this.onLeftMouseDoubleClick=function(evt){var me_x=this._getMouseX(evt);var me_y=this._getMouseY(evt);if(me_x===undefined||me_y===undefined){return}if(this._Object._GUIObject!==null){this._Object._GUIObject.mouseDoubleClick(evt,me_x,me_y)}};this.sendCommand=function(cmd){this.wsapi.publish(cmd)};this.receiveCommand=function(cmd_obj){if(cmd_obj===undefined){return}if(cmd_obj===null){return}var new_cmd=new WAC.anno[cmd_obj.cmdType](cmd_obj);new_cmd.apply(this);this.redraw()};this.redraw=function(){if(this.canvas.getContext){this.ctx.clearRect(this.canvas.clientLeft,this.canvas.clientTop,this.canvas.clientWidth/this._scaleFactorX,this.canvas.clientHeight/this._scaleFactorY)}this._Object.draw(this.ctx)};this.clear=function(){for(var i=this._Object._Shapes.length-1;i>=0;i--){if(this._Object._Shapes[i]._annotationObject===true){this._Object._Shapes[i].remove()}}this.sendCommand(new WAC.anno.wacCmd_Clear(this._Object.getID()))};this.testSaveRestoreObjects=function(){var objectData=this.saveObjects();var str=JSON.stringify(objectData);console.log(str);objectData=JSON.parse(str);console.log(objectData);this.restoreObjects(objectData,true)};this.saveObjects=function(){var objectData=[];for(var i=0;i<this._Object._Shapes.length;i++){objectData[i]=WAC.anno.wacUtil.applyExtraFormatting(this._Object._Shapes[i].getObjectData(),this.ctx)}return objectData};this.restoreObjects=function(objectData,generate_new_ids){for(var i=0;i<objectData.length;i++){objectData[i]=WAC.anno.wacUtil.unapplyExtraFormatting(objectData[i],this.ctx);var obj_type=objectData[i].type;var gobj=null;if(generate_new_ids){gobj=eval("new "+obj_type+"("+this.getUniqueObjectID()+", null, null, null, null, null);")}else{gobj=eval("new "+obj_type+"("+objectData[i].id+", null, null, null, null, null);")}gobj._ctx=this.ctx;gobj.canvas=WAC.anno.wacUtil.getCanvas(this.ctx);gobj.initMenus();gobj.restoreFromData(objectData[i]);this._Object.add(gobj)}};this.sendObjectsData=function(){var data=this.saveObjects()}};WAC.anno.wacCmd_Clear=WAC.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_Clear",arguments[0].objID)}else{if(arguments.length==1){this.base("wacCmd_Clear",arguments[0])}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_Clear(should be 1)"}}},applyCmd:function(gobj){var wac_canvas=WAC.anno.wacUtil.get_wacCanvas(gobj);for(var i=wac_canvas._Object._Shapes.length-1;i>=0;i--){if(wac_canvas._Object._Shapes[i]._annotationObject===true){wac_canvas._Object._Shapes[i].remove()}}}},{});WAC.anno.wacCmd_SendObjectsData=WAC.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SendObjectsData",arguments[0].objID);this.data=arguments[0].data}else{if(arguments.length==2){this.base("wacCmd_SendObjectsData",arguments[0]);this.data=arguments[1]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_Clear(should be 1)"}}},applyCmd:function(gobj){var wac_canvas=WAC.anno.wacUtil.get_wacCanvas(gobj);wac_canvas.restoreObjects(this.data)}},{})})(this);(function(b){var a=b.WAC||(b.WAC={});a.anno=a.anno||{};if(a.anno.wacLine){console.warn("WAC.anno.wacGObject is already defined");return}a.anno.createLine=function(d,e,g,c,f){var h=new a.anno.wacLine(d.getUniqueObjectID(),d.ctx,e,g,c,f,true);if((e===null)||(g===null)||(c===null)||(f===null)){d._Object.setNewObject(h);h.canvas.style.cursor="crosshair"}else{d._Object.add(h)}d.sendCommand(new a.anno.wacCmd_NewLine(d._Object.getID(),e,g))};a.anno.wacLine=a.anno.wacGObject.extend({constructor:function(i,c,e,h,d,g,f){this.base(i,c);this._type="WAC.anno.wacLine";this.x1=e;this.y1=h;this.x2=d;this.y2=g;this.hasArrow=f;this._lineWidth=2;this._lineColor="#00008B";this._fillColor="#00008B";this.HOT_DISTANCE=5;this.dragBegin=false;this.dragEnd=false;a.anno.wacUtil.initLine(this);if(c){this.initMenus()}},getObjectData:function(){var c=this.base();c.hasArrow=this.hasArrow;a.anno.wacUtil.getLineData(this,c);return c},restoreFromData:function(c){this.base(c);this.hasArrow=c.hasArrow;a.anno.wacUtil.setLineData(this,c)},initMenus:function(){var c=a.anno.wacUtil.get_wacCanvas(this);if(c.menus[this._type]===undefined){var d={id:"tLineMenu",Base:c,Width:100,ClickEventListener:this.OnMenuItemSelect};c.menus[this._type]=new CustomContextMenu(d);c.menus[this._type].AddItem("/wac-w1/shr/anno/images/linewidth16.png","Line Width",false,this._type+".changeLineWidth");c.menus[this._type].AddItem("/wac-w1/shr/anno/images/rainbow16.png","Line Color",false,this._type+".changeLineColor");c.menus[this._type].AddSeparatorItem();if((a.gisanno!==undefined)||(a.gisanno!==undefined)){c.menus[this._type].AddItem("/wac-w1/shr/anno/images/layers.png","Set Altitude",false,this._type+".changeAltitude")}c.menus[this._type].AddItem("/wac-w1/shr/anno/images/right-arrow.png","Arrow On/Off",false,this._type+".arrow");c.menus[this._type].AddSeparatorItem();c.menus[this._type].AddItem("/wac-w1/shr/anno/images/delete16.png","Delete",false,this._type+".delete")}},init:function(e,c,i){a.anno.wacUtil.initNullLine(this,c,i);if(this.entity===undefined){this.sendCommand(new a.anno.wacCmd_LineInit(this.getID(),c,i))}else{var d=this.entity.polyline.positions;var f=d.getValue(0);var h=f[0];var g=f[1];this.sendCommand(new a.anno.wacCmd_LineInit(this.getID(),c,i,h.x,h.y,h.z,g.x,g.y,g.z))}},OnMenuItemSelect:function(j,l,i){var k=l.CommandName;var h=k.substr(0,k.lastIndexOf("."));var d=i.menus[h].xLeft;var c=i.menus[h].yTop;var g=i._scaleFactorX;var f=i._scaleFactorY;i.hideMenus();switch(l.CommandName){case"WAC.anno.wacLine.changeLineWidth":a.anno.dialogs.displayEditLineWidthDialog(i,i._Object._GUIObject,i._Object._GUIObject._lineWidth);break;case"WAC.anno.wacLine.changeAltitude":a.anno.dialogs.displayEditAltitudeDialog(i,i._Object._GUIObject,i._Object._GUIObject._altitude);break;case"WAC.anno.wacLine.changeLineColor":a.anno.dialogs.displayEditColorDialog(i,i._Object._GUIObject,i._Object._GUIObject._lineColor,"_lineColor");break;case"WAC.anno.wacLine.arrow":a.anno.wacUtil.setArrowOnOff(i._Object._GUIObject);var e=new a.anno.wacCmd_SetHasArrow(i._Object._GUIObject.getID(),i._Object._GUIObject.hasArrow);i.sendCommand(e);break;case"WAC.anno.wacLine.delete":var e=new a.anno.wacCmd_RemoveObject(i._Object.getID(),i._Object._GUIObject.getID());i._Object._GUIObject.remove();i.sendCommand(e);break}i.redraw()},remove:function(){a.anno.wacUtil.removeLine(this)},hide:function(){this.base();a.anno.wacUtil.hideLine(this)},show:function(){this.base();a.anno.wacUtil.showLine(this)},draw:function(){a.anno.wacUtil.drawLine(this)},inside:function(c,d){return a.anno.wacUtil.insideLine(this,c,d)},getPositions:function(){if(this.self&&this.self.drag_positions){return this.self.drag_positions}},mouseEnter:function(d,c,e){this.base(d,c,e);this.draw()},mouseExit:function(d,c,e){this.base(d,c,e);this.draw()},move:function(k,m,l){if(this.entity===undefined){a.anno.wacUtil.moveLine(this,m,l);this.sendCommand(new a.anno.wacCmd_MoveLine(this.getID(),this.x1,this.y1,this.x2,this.y2))}else{var f=this.entity.polyline.positions;var j=f.getValue(0);var i=j[0].clone();var h=j[1].clone();a.anno.wacUtil.moveLine(this,m,l);var e=this.entity.polyline.positions;var g=e.getValue(0);var d=g[0].clone();var c=g[1].clone();this.sendCommand(new a.anno.wacCmd_MoveLine(this.getID(),d.x,d.y,d.z,c.x,c.y,c.z))}},mouseDown:function(d,c,f){var e=a.anno.wacUtil.getLineVertices(this);if(this.withinHotDistance(c,f,e[0].x,e[0].y)){this.dragBegin=true;this.dragEnd=false}else{if(this.withinHotDistance(c,f,e[1].x,e[1].y)){this.dragBegin=false;this.dragEnd=true}else{this.dragBegin=false;this.dragEnd=false}}a.anno.wacUtil.setLineGetPositionsCallback(this)},mouseUp:function(d,c,e){a.anno.wacUtil.removeLineGetPositionsCallback(this);this.dragBegin=false;this.dragEnd=false},mouseDrag:function(m,j,g){if(this.dragBegin){var o=j-this.x1;var n=g-this.y1;if(this.entity===undefined){a.anno.wacUtil.setLineBeginPosition(this,j,g);this.sendCommand(new a.anno.wacCmd_MoveLine(this.getID(),this.x1,this.y1,this.x2,this.y2))}else{var f=this.entity.polyline.positions;var l=f.getValue(0);var k=l[0].clone();var i=l[1].clone();a.anno.wacUtil.setLineBeginPosition(this,j,g);var e=this.entity.polyline.positions;var h=e.getValue(0);var d=h[0].clone();var c=h[1].clone();this.sendCommand(new a.anno.wacCmd_MoveLine(this.getID(),d.x,d.y,d.z,c.x,c.y,c.z))}return true}else{if(this.dragEnd){var o=j-this.x2;var n=g-this.y2;if(this.entity===undefined){a.anno.wacUtil.setLineEndPosition(this,j,g);this.sendCommand(new a.anno.wacCmd_MoveLine(this.getID(),this.x1,this.y1,this.x2,this.y2))}else{var f=this.entity.polyline.positions;var l=f.getValue(0);var k=l[0].clone();var i=l[1].clone();a.anno.wacUtil.setLineEndPosition(this,j,g);var e=this.entity.polyline.positions;var h=e.getValue(0);var d=h[0].clone();var c=h[1].clone();this.sendCommand(new a.anno.wacCmd_MoveLine(this.getID(),d.x,d.y,d.z,c.x,c.y,c.z))}return true}}return false},mouseMove:function(d,c,f){var e=a.anno.wacUtil.getLineVertices(this);if(this.withinHotDistance(c,f,e[0].x,e[0].y)){this.canvas.style.cursor="nw-resize"}else{if(this.withinHotDistance(c,f,e[1].x,e[1].y)){this.canvas.style.cursor="ne-resize"}else{this.canvas.style.cursor="move"}}}},{});a.anno.wacCmd_NewLine=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_NewLine",arguments[0].objID);this.x=arguments[0].x;this.y=arguments[0].y}else{if(arguments.length==3){this.base("wacCmd_NewLine",arguments[0]);this.x=arguments[1];this.y=arguments[2]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_NewLine(should be 3)"}}},applyCmd:function(e){if((this.x===null)||(this.y===null)){var c=a.anno.wacUtil.get_wacCanvas(e).getUniqueObjectID();var d=new a.anno.wacLine(c,e._ctx,null,null,null,null,true);e.add(d);e._newObject=d}else{e.add(new a.anno.wacLine(a.anno.wacUtil.get_wacCanvas(e).getUniqueObjectID(),e._ctx,this.x,this.y,this.x+100,this.y+100,true))}}},{});a.anno.wacCmd_LineInit=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_LineInit",arguments[0].objID);this.x=arguments[0].x;this.y=arguments[0].y;if(arguments[0].x1!==undefined){this.x1=arguments[0].x1}if(arguments[0].y1!==undefined){this.y1=arguments[0].y1}if(arguments[0].z1!==undefined){this.z1=arguments[0].z1}if(arguments[0].x2!==undefined){this.x2=arguments[0].x2}if(arguments[0].y2!==undefined){this.y2=arguments[0].y2}if(arguments[0].z2!==undefined){this.z2=arguments[0].z2}}else{if(arguments.length==3){this.base("wacCmd_LineInit",arguments[0]);this.x=arguments[1];this.y=arguments[2]}else{if(arguments.length==9){this.base("wacCmd_LineInit",arguments[0]);this.x=arguments[1];this.y=arguments[2];this.x1=arguments[3];this.y1=arguments[4];this.z1=arguments[5];this.x2=arguments[6];this.y2=arguments[7];this.z2=arguments[8]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_LineInit(should be 3)"}}}},applyCmd:function(c){c.x1=this.x-10;c.y1=this.y-10;c.x2=this.x;c.y2=this.y;c._parentObject._newObject=null;if(this.x1!==undefined){a.anno.wacUtil.initLineFromCommand(c,this)}}},{});a.anno.wacCmd_MoveLine=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_MoveLine",arguments[0].objID);this.x1=arguments[0].x1;this.y1=arguments[0].y1;if(arguments[0].z1!==undefined){this.z1=arguments[0].z1}this.x2=arguments[0].x2;this.y2=arguments[0].y2;if(arguments[0].z2!==undefined){this.z2=arguments[0].z2}}else{if(arguments.length==5){this.base("wacCmd_MoveLine",arguments[0]);this.x1=arguments[1];this.y1=arguments[2];this.x2=arguments[3];this.y2=arguments[4]}else{if(arguments.length==7){this.base("wacCmd_MoveLine",arguments[0]);this.x1=arguments[1];this.y1=arguments[2];this.z1=arguments[3];this.x2=arguments[4];this.y2=arguments[5];this.z2=arguments[6]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_MoveLine(should be 5)"}}}},applyCmd:function(c){if(c.entity===undefined){c.x1=this.x1;c.y1=this.y1;c.x2=this.x2;c.y2=this.y2}else{if(c.entity!==undefined){c.drag_positions[0].x=this.x1;c.drag_positions[0].y=this.y1;c.drag_positions[0].z=this.z1;c.drag_positions[1].x=this.x2;c.drag_positions[1].y=this.y2;c.drag_positions[1].z=this.z2}}}},{});a.anno.wacCmd_SetHasArrow=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetHasArrow",arguments[0].objID);this.hasArrow=arguments[0].hasArrow}else{if(arguments.length==2){this.base("wacCmd_SetHasArrow",arguments[0]);this.hasArrow=arguments[1]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_SetHasArrow(should be 2)"}}},applyCmd:function(c){a.anno.wacUtil.setLineHasArrow(c,this.hasArrow)}},{})})(this);(function(b){var a=b.WAC||(b.WAC={});a.anno=a.anno||{};if(a.anno.wacRect){console.warn("WAC.anno.wacRect is already defined");return}a.anno.createRect=function(d,c,f){var e=new a.anno.wacRect(d.getUniqueObjectID(),d.ctx,c,f,100,100);if((c===null)||(f===null)){d._Object.setNewObject(e);e.canvas.style.cursor="crosshair"}else{d._Object.add(e)}d.sendCommand(new a.anno.wacCmd_NewRect(d._Object.getID(),c,f));return e};a.anno.wacRect=a.anno.wacGObject.extend({constructor:function(i,e,c,g,d,f){this.base(i,e);this._type="WAC.anno.wacRect";this._X=c;this._Y=g;this._W=d;this._H=f;this._lineColor="#FFFF00";this._fillColor="#FFFF00";this._transparent=false;this._opacity=0.5;this.HOT_DISTANCE=10;this.dragTL=false;this.dragBL=false;this.dragTR=false;this.dragBR=false;this.dragT=false;this.dragL=false;this.dragR=false;this.dragB=false;this._x1=0;this._y1=0;this._opacity=0.5;a.anno.wacUtil.initRectangle(this);if(e){this.initMenus()}},getObjectData:function(){var c=this.base();c.transparent=this._transparent;c.opacity=this._opacity;a.anno.wacUtil.getRectangleData(this,c);return c},restoreFromData:function(c){this.base(c);this._transparent=c.transparent;this._opacity=c.opacity;a.anno.wacUtil.setRectangleData(this,c)},initMenus:function(){var c=a.anno.wacUtil.get_wacCanvas(this);if(c.menus[this._type]===undefined){var d={id:"tRectMenu",Base:c,Width:100,ClickEventListener:this.OnMenuItemSelect};c.menus[this._type]=new CustomContextMenu(d);c.menus[this._type].AddItem("/wac-w1/shr/anno/images/linewidth16.png","Line Width",false,this._type+".changeLineWidth");c.menus[this._type].AddItem("/wac-w1/shr/anno/images/rainbow16.png","Line Color",false,this._type+".changeLineColor");c.menus[this._type].AddItem("/wac-w1/shr/anno/images/rainbow16.png","Fill Color",false,this._type+".changeFillColor");c.menus[this._type].AddItem("/wac-w1/shr/anno/images/rainbow16.png","Opacity",false,this._type+".changeOpacity");c.menus[this._type].AddSeparatorItem();if((a.gisanno!==undefined)||(a.gisanno!==undefined)){c.menus[this._type].AddItem("/wac-w1/shr/anno/images/layers.png","Set Altitude",false,this._type+".changeAltitude");c.menus[this._type].AddSeparatorItem()}c.menus[this._type].AddItem("/wac-w1/shr/anno/images/delete16.png","Delete",false,this._type+".delete")}},init:function(d,c,g){a.anno.wacUtil.initNullRectangle(this,c,g);if(this.entity===undefined){this.sendCommand(new a.anno.wacCmd_RectInit(this.getID(),c,g))}else{var f=this.entity.rectangle.coordinates;var e=f.getValue(0);this.sendCommand(new a.anno.wacCmd_RectInit(this.getID(),c,g,e.west,e.east,e.north,e.south))}},OnMenuItemSelect:function(j,l,i){var k=l.CommandName;var h=k.substr(0,k.lastIndexOf("."));var d=i.menus[h].xLeft;var c=i.menus[h].yTop;var g=i._scaleFactorX;var f=i._scaleFactorY;i.hideMenus();switch(l.CommandName){case"WAC.anno.wacRect.changeLineWidth":a.anno.dialogs.displayEditLineWidthDialog(i,i._Object._GUIObject,i._Object._GUIObject._lineWidth);break;case"WAC.anno.wacRect.changeAltitude":a.anno.dialogs.displayEditAltitudeDialog(i,i._Object._GUIObject,i._Object._GUIObject._altitude);break;case"WAC.anno.wacRect.changeLineColor":a.anno.dialogs.displayEditColorDialog(i,i._Object._GUIObject,i._Object._GUIObject._lineColor,"_lineColor");break;case"WAC.anno.wacRect.changeFillColor":a.anno.dialogs.displayEditColorDialog(i,i._Object._GUIObject,i._Object._GUIObject._fillColor,"_fillColor");break;case"WAC.anno.wacRect.changeOpacity":a.anno.dialogs.displayEditOpacityDialog(i,i._Object._GUIObject,i._Object._GUIObject._opacity);break;case"WAC.anno.wacRect.transparent":i._Object._GUIObject._transparent=!i._Object._GUIObject._transparent;var e=new a.anno.wacCmd_SetTransparent(i._Object._GUIObject.getID(),i._Object._GUIObject._transparent);i.sendCommand(e);break;case"WAC.anno.wacRect.delete":var e=new a.anno.wacCmd_RemoveObject(i._Object.getID(),i._Object._GUIObject.getID());i._Object._GUIObject.remove();i.sendCommand(e);break}i.redraw()},inside:function(c,d){return a.anno.wacUtil.insideRectangle(this,c,d)},remove:function(){a.anno.wacUtil.removeRectangle(this)},hide:function(){this.base();a.anno.wacUtil.hideRectangle(this)},show:function(){this.base();a.anno.wacUtil.showRectangle(this)},setOpacity:function(c){this._opacity=c;a.anno.wacUtil.setOpacity(this,c)},draw:function(){a.anno.wacUtil.drawRectangle(this)},getCoordinates:function(){if(this.self&&this.self.drag_coordinates){return this.self.drag_coordinates}},move:function(d,e,c){if(this.entity===undefined){a.anno.wacUtil.moveRect(this,e,c);this.sendCommand(new a.anno.wacCmd_SetRectPositions(this.getID(),this._X,this._Y,this._X+this._W,this._Y+this._H))}else{var g={west:this.drag_coordinates.west,east:this.drag_coordinates.east,north:this.drag_coordinates.north,south:this.drag_coordinates.south};if((e!==0)&&(c!==0)){var h=123}a.anno.wacUtil.moveRect(this,e,c);var f={west:this.drag_coordinates.west,east:this.drag_coordinates.east,north:this.drag_coordinates.north,south:this.drag_coordinates.south};this.sendCommand(new a.anno.wacCmd_SetRectPositions(this.getID(),f.west,f.north,f.east,f.south))}},mouseDown:function(e,c,j){var d=a.anno.wacUtil.getRectangleCoordinateNE(this);var i=a.anno.wacUtil.getRectangleCoordinateNW(this);var g=a.anno.wacUtil.getRectangleCoordinateSE(this);var f=a.anno.wacUtil.getRectangleCoordinateSW(this);var h=Math.sqrt(2);this.dragTL=false;this.dragBL=false;this.dragTR=false;this.dragBR=false;this.dragT=false;this.dragL=false;this.dragR=false;this.dragB=false;if(this.withinHotDistance(c,j,g.x,g.y)){this.dragBR=true}else{if(this.withinHotDistance(c,j,d.x,d.y)){this.dragTR=true}else{if(this.withinHotDistance(c,j,i.x,i.y)){this.dragTL=true}else{if(this.withinHotDistance(c,j,f.x,f.y)){this.dragBL=true}}}}this._x1=c;this._y1=j;a.anno.wacUtil.setRectCoordinatesCallback(this)},mouseUp:function(d,c,e){this.dragTL=false;this.dragBL=false;this.dragTR=false;this.dragBR=false;this.dragT=false;this.dragL=false;this.dragR=false;this.dragB=false;a.anno.wacUtil.removeRectCoordinatesCallback(this)},mouseDrag:function(e,c,i){var h=this.getMouseX(e);var g=this.getMouseY(e);var f=h-this._x1;var d=g-this._y1;if(this.dragTL){a.anno.wacUtil.moveRectVertexNW(this,f,d);return true}else{if(this.dragBL){a.anno.wacUtil.moveRectVertexSW(this,f,d);return true}else{if(this.dragTR){a.anno.wacUtil.moveRectVertexNE(this,f,d);return true}else{if(this.dragBR){a.anno.wacUtil.moveRectVertexSE(this,f,d);return true}else{if(this.dragT){a.anno.wacUtil.moveRectSideN(this,f,d);return true}else{if(this.dragL){a.anno.wacUtil.moveRectSideW(this,f,d);return true}else{if(this.dragR){a.anno.wacUtil.moveRectSideE(this,f,d);return true}else{if(this.dragB){a.anno.wacUtil.moveRectSideS(this,f,d);return true}}}}}}}}return false},mouseMove:function(e,c,j){var d=a.anno.wacUtil.getRectangleCoordinateNE(this);var i=a.anno.wacUtil.getRectangleCoordinateNW(this);var g=a.anno.wacUtil.getRectangleCoordinateSE(this);var f=a.anno.wacUtil.getRectangleCoordinateSW(this);var h=Math.sqrt(2);if(this.withinHotDistance(c,j,g.x,g.y)){this.canvas.style.cursor="se-resize"}else{if(this.withinHotDistance(c,j,d.x,d.y)){this.canvas.style.cursor="ne-resize"}else{if(this.withinHotDistance(c,j,i.x,i.y)){this.canvas.style.cursor="nw-resize"}else{if(this.withinHotDistance(c,j,f.x,f.y)){this.canvas.style.cursor="sw-resize"}else{this.canvas.style.cursor="move"}}}}}},{});a.anno.wacCmd_NewRect=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_NewRect",arguments[0].objID);this.x=arguments[0].x;this.y=arguments[0].y}else{if(arguments.length==3){this.base("wacCmd_NewRect",arguments[0]);this.x=arguments[1];this.y=arguments[2]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_NewRect(should be 3)"}}},applyCmd:function(e){var c=a.anno.wacUtil.get_wacCanvas(e).getUniqueObjectID();var d=new a.anno.wacRect(c,e._ctx,null,null,100,100);e.add(d);e._newObject=d}},{});a.anno.wacCmd_RectInit=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_RectInit",arguments[0].objID);this.x=arguments[0].x;this.y=arguments[0].y;if(arguments[0].west!==undefined){this.west=arguments[0].west}if(arguments[0].east!==undefined){this.east=arguments[0].east}if(arguments[0].north!==undefined){this.north=arguments[0].north}if(arguments[0].south!==undefined){this.south=arguments[0].south}}else{if(arguments.length==3){this.base("wacCmd_RectInit",arguments[0]);this.x=arguments[1];this.y=arguments[2]}else{if(arguments.length==7){this.base("wacCmd_RectInit",arguments[0]);this.x=arguments[1];this.y=arguments[2];this.west=arguments[3];this.east=arguments[4];this.north=arguments[5];this.south=arguments[6]}else{throw"Error:  wrong number of arguments for WAC.anno.wacCmd_RectInit(should be 3)"}}}},applyCmd:function(c){c._X=this.x-20;c._Y=this.y-20;c._W=20;c._H=20;c._parentObject._newObject=null;if(this.west!==undefined){a.anno.wacUtil.initRectangleFromCommand(c,this)}}},{});a.anno.wacCmd_MoveRect=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_MoveRect",arguments[0].objID);this.dx=arguments[0].dx;this.dy=arguments[0].dy;if(arguments[0].dwest!==undefined){this.dwest=arguments[0].dwest}if(arguments[0].deast!==undefined){this.deast=arguments[0].deast}if(arguments[0].dnorth!==undefined){this.dnorth=arguments[0].dnorth}if(arguments[0].dsouth!==undefined){this.dsouth=arguments[0].dsouth}}else{if(arguments.length==3){this.base("wacCmd_MoveRect",arguments[0]);this.dx=arguments[1];this.dy=arguments[2]}else{if(arguments.length==7){this.base("wacCmd_MoveRect",arguments[0]);this.dx=arguments[1];this.dy=arguments[2];this.dwest=arguments[3];this.deast=arguments[4];this.dnorth=arguments[5];this.dsouth=arguments[6]}else{throw"Error:  wrong number of arguments for wacCmd_MoveRect(should be 3)"}}}},applyCmd:function(d){if(d.entity===undefined){a.anno.wacUtil.moveRect(d,this.dx,this.dy)}else{if(d.entity!==undefined){if(this.dwest===undefined){var c=12345}d.drag_coordinates.west+=this.dwest;d.drag_coordinates.east+=this.deast;d.drag_coordinates.north+=this.dnorth;d.drag_coordinates.south+=this.dsouth}}}},{});a.anno.wacCmd_SetRectPositions=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetRectPositions",arguments[0].objID);this.x1=arguments[0].x1;this.y1=arguments[0].y1;this.x2=arguments[0].x2;this.y2=arguments[0].y2}else{if(arguments.length==5){this.base("wacCmd_SetRectPositions",arguments[0]);this.x1=arguments[1];this.y1=arguments[2];this.x2=arguments[3];this.y2=arguments[4]}else{throw"Error:  wrong number of arguments for wacCmd_SetRectPositions(should be 4)"}}},applyCmd:function(d){if(d.entity===undefined){d._X=this.x1;d._Y=this.y1;d._W=this.x2-this.x1;d._H=this.y2-this.y1}else{var c=d.drag_coordinates;c.west=this.x1;c.east=this.x2;c.north=this.y1;c.south=this.y2}}},{});a.anno.wacCmd_SetTransparent=a.anno.wacCommand.extend({constructor:function(){if((arguments.length==1)&&(typeof arguments[0]==="object")){this.base("wacCmd_SetTransparent",arguments[0].objID);this.transparent=arguments[0].transparent}else{if(arguments.length==2){this.base("wacCmd_SetTransparent",arguments[0]);this.transparent=arguments[1]}else{throw"Error:  wrong number of arguments for wacCmd_SetTransparent(should be 3)"}}},applyCmd:function(c){c._transparent=this.transparent}},{})})(this);"use strict";var WAC=WAC||{};WAC.anno=WAC.anno||{};WAC.anno.dialogs=WAC.anno.dialogs||{};WAC.anno.dialogs=(function(){var l=null;var d=null;function e(){var p=document.createElement("canvas");p.setAttribute("id","waccanvas");p.setAttribute("class","coveringCanvas");p.style.width="90%";p.style.height="90%";document.body.appendChild(p)}function g(){var t=document.createElement("div");t.setAttribute("id","overlayEditText");t.setAttribute("class","overlay");document.body.appendChild(t);var s=document.createElement("div");s.setAttribute("id","divEditText");s.setAttribute("class","overlayDivEdit");t.appendChild(s);var r=document.createElement("div");r.setAttribute("id","formEditText");r.setAttribute("class","overlayForm");s.appendChild(r);var u=document.createElement("textarea");u.setAttribute("id","inputTextArea");u.style.width="200px";u.style.height="100px";u.value="some text";r.appendChild(u);r.appendChild(document.createElement("br"));var q=document.createElement("button");q.setAttribute("id","buttonEditTextOK");q.setAttribute("class","btn btn-primary");q.value="OK";q.appendChild(document.createTextNode("OK"));q.onclick=function(v){var w=document.getElementById("overlayEditText");var y=document.getElementById("inputTextArea");WAC.anno.wacUtil.setText(d,y.value);w.style.visibility="hidden";l.redraw();var x=new WAC.anno.wacCmd_SetText(d.getID(),y.value);l.sendCommand(x)};r.appendChild(q);var p=document.createElement("button");p.setAttribute("id","buttonEditTextCancel");p.setAttribute("class","btn btn-warning");p.value="Cancel";p.appendChild(document.createTextNode("Cancel"));p.onclick=function(){document.getElementById("overlayEditText").style.visibility="hidden"};r.appendChild(p)}function a(s,q,t){l=s;d=q;var p=document.getElementById("overlayEditText");var r=document.getElementById("inputTextArea");r.focus();r.value=t;p.style.visibility="visible"}function o(){var x=document.createElement("div");x.setAttribute("id","overlayEditFont");x.setAttribute("class","overlay");document.body.appendChild(x);var w=document.createElement("div");w.setAttribute("id","divEditFont");w.setAttribute("class","overlayDivFont");x.appendChild(w);var B=document.createElement("div");B.setAttribute("id","formEditFont");B.setAttribute("class","overlayForm");w.appendChild(B);var r=document.createElement("select");r.setAttribute("name","fontname");r.setAttribute("id","inputFontFamily");B.appendChild(r);var p=document.createElement("option");p.setAttribute("value","sans-serif");p.appendChild(document.createTextNode("sans-serif"));r.appendChild(p);var C=document.createElement("option");C.setAttribute("value","Arial");C.appendChild(document.createTextNode("Arial"));r.appendChild(C);var A=document.createElement("option");A.setAttribute("value","Courier New");r.appendChild(A);A.appendChild(document.createTextNode("Courier New"));var z=document.createElement("option");z.setAttribute("value","Times New Roman");z.appendChild(document.createTextNode("Times New Roman"));r.appendChild(z);var y=document.createElement("option");y.setAttribute("value","Verdana");y.appendChild(document.createTextNode("Verdana"));r.appendChild(y);var q=document.createElement("select");q.setAttribute("name","fontsize");q.setAttribute("id","inputFontSize");B.appendChild(q);var C=document.createElement("option");C.setAttribute("value","10");C.appendChild(document.createTextNode("10"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","14");C.appendChild(document.createTextNode("14"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","20");C.appendChild(document.createTextNode("20"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","26");C.appendChild(document.createTextNode("26"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","32");C.appendChild(document.createTextNode("32"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","48");C.appendChild(document.createTextNode("48"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","64");C.appendChild(document.createTextNode("64"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","72");C.appendChild(document.createTextNode("72"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","86");C.appendChild(document.createTextNode("86"));q.appendChild(C);C=document.createElement("option");C.setAttribute("value","140");C.appendChild(document.createTextNode("140"));q.appendChild(C);var v=document.createElement("input");v.setAttribute("type","checkbox");v.setAttribute("id","inputFontIsBold");v.setAttribute("name","bold");v.setAttribute("value","bold");B.appendChild(v);B.appendChild(document.createTextNode("bold"));var u=document.createElement("input");u.setAttribute("type","checkbox");u.setAttribute("id","inputFontIsItalic");u.setAttribute("name","italic");u.setAttribute("value","italic");B.appendChild(u);B.appendChild(document.createTextNode("italic"));B.appendChild(document.createElement("br"));var t=document.createElement("button");t.setAttribute("id","buttonEditFontOK");t.setAttribute("class","btn btn-primary");t.value="OK";t.appendChild(document.createTextNode("OK"));t.onclick=function(M){var H=document.getElementById("overlayEditFont");var J=document.getElementById("inputEditFont");var F=document.getElementById("waccanvas");var L=F.self;var D=document.getElementById("inputFontFamily");var I=document.getElementById("inputFontSize");var K=document.getElementById("inputFontIsBold");var E=document.getElementById("inputFontIsItalic");L._Object._GUIObject.fontFamily=document.getElementById("inputFontFamily").value;L._Object._GUIObject.fontSize=document.getElementById("inputFontSize").value;L._Object._GUIObject.isBold=document.getElementById("inputFontIsBold").checked;L._Object._GUIObject.isItalic=document.getElementById("inputFontIsItalic").checked;L._Object._GUIObject.computeSize();H.style.visibility="hidden";L.ctx.clearRect(F.clientLeft,F.clientTop,F.clientWidth,F.clientHeight);L._Object.draw(L.ctx);var G=new WAC.anno.wacCmd_SetFont(L._Object._GUIObject.getID(),L._Object._GUIObject.isItalic,L._Object._GUIObject.isBold,L._Object._GUIObject.fontSize,L._Object._GUIObject.fontFamily);L.sendCommand(G)};B.appendChild(t);var s=document.createElement("button");s.setAttribute("id","buttonEditFontCancel");s.setAttribute("class","btn btn-warning");s.value="Cancel";s.appendChild(document.createTextNode("Cancel"));s.onclick=function(){document.getElementById("overlayEditFont").style.visibility="hidden"};B.appendChild(s)}function j(r){var p=document.getElementById("overlayEditFont");var u=document.getElementById("inputFontFamily");var q=document.getElementById("inputFontSize");var t=document.getElementById("inputFontIsBold");var s=document.getElementById("inputFontIsItalic");u.value=r.fontFamily;q.value=r.fontSize;t.checked=r.isBold;s.checked=r.isItalic;p.style.visibility="visible"}function i(){var u=document.createElement("div");u.setAttribute("id","overlayEditLineWidth");u.setAttribute("class","overlay");document.body.appendChild(u);var t=document.createElement("div");var t=document.createElement("div");t.setAttribute("id","divEditLineWidth");t.setAttribute("class","overlayDiv");u.appendChild(t);t.appendChild(document.createTextNode("Select Line Width"));var r=document.createElement("input");r.setAttribute("class","slider");r.setAttribute("type","range");r.setAttribute("id","lineWidth");r.setAttribute("min","1");r.setAttribute("max","20");r.oninput=function(w){var x=document.getElementById("lineWidth");var v=document.getElementById("lineWidthId");v.value=x.value};t.appendChild(r);var s=document.createElement("input");s.setAttribute("type","number");s.setAttribute("id","lineWidthId");s.setAttribute("class","numb");s.setAttribute("min","1");s.setAttribute("max","20");s.oninput=function(w){var x=document.getElementById("lineWidth");var v=document.getElementById("lineWidthId");x.value=v.value;v.value=x.value};t.appendChild(s);t.appendChild(document.createElement("br"));var q=document.createElement("button");q.setAttribute("id","buttonEditLineWidthOK");q.setAttribute("class","btn btn-primary");q.value="OK";q.appendChild(document.createTextNode("OK"));q.onclick=function(v){var w=document.getElementById("overlayEditLineWidth");var x=document.getElementById("lineWidth");WAC.anno.wacUtil.setLineWidth(d,x.value);w.style.visibility="hidden";l.redraw();var y=new WAC.anno.wacCmd_SetLineWidth(d.getID(),x.value);l.sendCommand(y)};t.appendChild(q);var p=document.createElement("button");p.setAttribute("id","buttonEditLineWidthCancel");p.setAttribute("class","btn btn-warning");p.value="Cancel";p.appendChild(document.createTextNode("Cancel"));p.onclick=function(){document.getElementById("overlayEditLineWidth").style.visibility="hidden"};t.appendChild(p)}function h(t,s,u){l=t;d=s;var q=document.getElementById("overlayEditLineWidth");var r=document.getElementById("lineWidth");var p=document.getElementById("lineWidthId");r.value=u;p.value=u;q.style.visibility="visible"}function n(){var t=document.createElement("div");t.setAttribute("id","overlayEditColor");t.setAttribute("class","overlay");document.body.appendChild(t);var s=document.createElement("div");s.setAttribute("id","divEditColor");s.setAttribute("class","overlayDivColor");t.appendChild(s);s.appendChild(document.createTextNode("Click to select color"));var r=document.createElement("input");r.setAttribute("type","color");r.setAttribute("class","color");r.setAttribute("id","inputEditColor");r.setAttribute("name","favcolor");s.appendChild(r);s.appendChild(document.createElement("br"));s.appendChild(document.createElement("br"));var q=document.createElement("button");q.setAttribute("id","buttonEditColorOK");q.setAttribute("class","btn btn-primary");q.value="OK";q.appendChild(document.createTextNode("OK"));q.onclick=function(u){var w=document.getElementById("overlayEditColor");var z=document.getElementById("inputEditColor");var v=document.getElementById("waccanvas");var x=u.target;WAC.anno.wacUtil.setPropertyColor(d,x.propName,z.value);w.style.visibility="hidden";l.redraw();var y=new WAC.anno.wacCmd_SetColor(d.getID(),x.propName,d[x.propName]);l.sendCommand(y)};s.appendChild(q);var p=document.createElement("button");p.setAttribute("id","buttonEditColorCancel");p.setAttribute("class","btn btn-warning");p.value="Cancel";p.appendChild(document.createTextNode("Cancel"));p.onclick=function(){document.getElementById("overlayEditColor").style.visibility="hidden"};s.appendChild(p)}function f(u,r,v,q){l=u;d=r;var s=document.getElementById("inputEditColor");if(v[0]==="#"){s.value=v}else{s.value="#"+v}var t=document.getElementById("buttonEditColorOK");t.propName=q;var p=document.getElementById("overlayEditColor");p.style.visibility="visible"}function m(){var u=document.createElement("div");u.setAttribute("id","overlayEditAltitude");u.setAttribute("class","overlay");document.body.appendChild(u);var t=document.createElement("div");var t=document.createElement("div");t.setAttribute("id","divEditAltitude");t.setAttribute("class","overlayDiv");u.appendChild(t);t.appendChild(document.createTextNode("Select Altitude (meters)"));var r=document.createElement("input");r.setAttribute("type","range");r.setAttribute("id","lineAltitude");r.setAttribute("min","0");r.setAttribute("max","5000");r.setAttribute("class","slider");r.oninput=function(w){var x=document.getElementById("lineAltitude");var v=document.getElementById("lineAltitudeValue");v.value=x.value};t.appendChild(r);var s=document.createElement("input");s.setAttribute("type","number");s.setAttribute("id","lineAltitudeValue");s.setAttribute("min","0");s.setAttribute("max","5000");s.setAttribute("class","numb");s.oninput=function(w){var x=document.getElementById("lineAltitude");var v=document.getElementById("lineAltitudeValue");x.value=v.value;v.value=x.value};t.appendChild(s);t.appendChild(document.createElement("br"));var q=document.createElement("button");q.setAttribute("id","buttonEditAltitudeOK");q.setAttribute("class","btn btn-primary");q.value="OK";q.appendChild(document.createTextNode("OK"));q.onclick=function(v){var w=document.getElementById("overlayEditAltitude");var x=document.getElementById("lineAltitude");WAC.anno.wacUtil.setAltitude(d,parseInt(x.value));w.style.visibility="hidden";l.redraw();var y=new WAC.anno.wacCmd_SetAltitude(d.getID(),x.value);l.sendCommand(y)};t.appendChild(q);var p=document.createElement("button");p.setAttribute("id","buttonEditAltitudeCancel");p.setAttribute("class","btn btn-warning");p.value="Cancel";p.appendChild(document.createTextNode("Cancel"));p.onclick=function(){document.getElementById("overlayEditAltitude").style.visibility="hidden"};t.appendChild(p)}function c(t,s,u){l=t;d=s;var q=document.getElementById("overlayEditAltitude");var r=document.getElementById("lineAltitude");var p=document.getElementById("lineAltitudeValue");r.value=u;p.value=u;q.style.visibility="visible"}function k(){var u=document.createElement("div");u.setAttribute("id","overlayEditOpacity");u.setAttribute("class","overlay");document.body.appendChild(u);var t=document.createElement("div");var t=document.createElement("div");t.setAttribute("id","divEditOpacity");t.setAttribute("class","overlayDiv");u.appendChild(t);t.appendChild(document.createTextNode("Select Opacity"));var r=document.createElement("input");r.setAttribute("type","range");r.setAttribute("id","lineOpacity");r.setAttribute("min","1");r.setAttribute("max","255");r.setAttribute("class","slider");r.oninput=function(w){var x=document.getElementById("lineOpacity");var v=document.getElementById("lineOpacityValue");var y=Math.round(10000*x.value/255);v.value=y/10000};t.appendChild(r);var s=document.createElement("input");s.setAttribute("type","number");s.setAttribute("id","lineOpacityValue");s.setAttribute("min","0.0");s.setAttribute("max","1.0");s.setAttribute("class","numb");s.oninput=function(w){var x=document.getElementById("lineOpacity");var v=document.getElementById("lineOpacityValue");x.value=v.value*255;var y=Math.round(v.value*10000);v.value=y/10000};t.appendChild(s);t.appendChild(document.createElement("br"));var q=document.createElement("button");q.setAttribute("id","buttonEditOpacityOK");q.setAttribute("class","btn btn-primary");q.value="OK";q.appendChild(document.createTextNode("OK"));q.onclick=function(v){var w=document.getElementById("overlayEditOpacity");var x=document.getElementById("lineOpacity");d.setOpacity(parseInt(x.value)/255);w.style.visibility="hidden";l.redraw();var y=new WAC.anno.wacCmd_SetOpacity(d.getID(),d._opacity);l.sendCommand(y)};t.appendChild(q);var p=document.createElement("button");p.setAttribute("id","buttonEditOpacityCancel");p.setAttribute("class","btn btn-warning");p.value="Cancel";p.appendChild(document.createTextNode("Cancel"));p.onclick=function(){document.getElementById("overlayEditOpacity").style.visibility="hidden"};t.appendChild(p)}function b(t,s,u){l=t;d=s;var q=document.getElementById("overlayEditOpacity");var r=document.getElementById("lineOpacity");var p=document.getElementById("lineOpacityValue");r.value=u*255;p.value=u;q.style.visibility="visible"}return{createEditTextDialog:g,displayEditTextDialog:a,createEditFontDialog:o,displayEditFontDialog:j,createEditLineWidthDialog:i,displayEditLineWidthDialog:h,createEditColorDialog:n,displayEditColorDialog:f,createEditAltitudeDialog:m,createEditOpacityDialog:k,displayEditAltitudeDialog:c,displayEditOpacityDialog:b}})();